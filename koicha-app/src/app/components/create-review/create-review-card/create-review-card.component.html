<!-- TODO: format this as a card properly -->
<ng-container *ngIf="productCard">
  <div class="create-review-card bg-white">
    <!-- product card details -->
    <!-- TODO: format the product card content properly  -->
    <app-product-card-content
      [hideProductMetrics]="true"
      [productCardData]="productCard"
    ></app-product-card-content>

    <ng-container *ngIf="preferences$ | async as preferences">
      <app-review-preference-selector
        [preferences]="preferences"
        [(preferenceSelected)]="selectedPreference"
      >
      </app-review-preference-selector>
    </ng-container>

    <ng-container class="create-review-actions">
      @switch (reviewStep) { @case (WRITE_REVIEW_STEP) {
      <div>
        <label class="review-input">
          <span class="review-input__label">Your thoughts</span>
          <textarea
            #reviewInput
            class="review-input__textbox"
            placeholder="Share your thoughts"
            rows="4"
          ></textarea>
        </label>
      </div>

      <button
        type="button"
        [disabled]="!selectedPreference"
        (click)="saveReviewInput(reviewInput.value, selectedPreference || '')"
      >
        Done
      </button>
      } @case (COMPARE_PRODUCTS_STEP) {
      <app-review-product-slider
        *ngIf="subPreferences$ | async as subPreferences"
        [subPreferences]="subPreferences"
        (subPreferenceSelected)="onSubPreferenceSelected($event)"
        [min]="minSubPreferenceValue"
        [max]="maxSubPreferenceValue"
        [initialRecommendationValue]="productCard.matchPercentage"
        (ratingValueChange)="onSliderChange($event)"
      >
      </app-review-product-slider>

      <app-ranking-lineup [productLineup]="productLineup"></app-ranking-lineup>
      <!-- BIND THIS  -->
      <button
        type="button"
        [disabled]="!selectedRating"
        (click)="createReview()"
      >
        Finish
      </button>
      } }
    </ng-container>
  </div>
</ng-container>

<!-- TODO: revisit product comparison post-MVP -->
<!-- <app-review-product-ranking
        (undoSelected)="undoSelected.emit()"
        (tooToughSelected)="tooToughSelected.emit()"
        (skipSelected)="skipSelected.emit()"
      ></app-review-product-ranking> -->
