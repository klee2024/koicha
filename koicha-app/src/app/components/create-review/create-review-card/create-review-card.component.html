<!-- TODO: format this as a card properly -->
<ng-container *ngIf="productCard">
  <div
    class="create-review-card bg-white max-w-3xl mx-auto rounded-[30px] border border-neutral-200 shadow-[0_20px_45px_rgba(0,0,0,0.08)] p-8 md:p-10 space-y-8"
  >
    <!-- product card details -->
    <!-- TODO: format the product card content properly  -->
    <app-product-card-content
      [hideProductMetrics]="true"
      [productCardData]="productCard"
    ></app-product-card-content>

    <ng-container *ngIf="preferences$ | async as preferences">
      <app-review-preference-selector
        [preferences]="preferences"
        (preferenceSelectedChange)="onPreferenceSelectorChange($event)"
      >
      </app-review-preference-selector>
    </ng-container>

    <div class="create-review-actions flex flex-col gap-6 -mt-2">
      @switch (reviewStep) { @case (WRITE_REVIEW_STEP) {
      <div class="w-full mt-0">
        <label
          class="review-input flex flex-col gap-3 text-left text-center w-full block"
        >
          <span
            class="review-input__label text-lg font-semibold tracking-wide text-neutral-900 font-mono"
          >
            Your Thoughts
          </span>
          <textarea
            #reviewInput
            class="review-input__textbox w-full min-h-[160px] resize-none rounded-2xl border border-neutral-900/20 bg-white/70 p-4 text-base leading-relaxed tracking-wide text-neutral-900 shadow-inner focus:outline-none focus:ring-2 focus:ring-neutral-900/40"
            placeholder="Share your thoughts"
            rows="4"
          ></textarea>
        </label>
      </div>

      <button
        class="mt-4 inline-flex h-12 items-center justify-center rounded-xl border border-emerald-800 px-10 text-lg font-medium tracking-wide text-emerald-900 transition hover:bg-emerald-50 disabled:cursor-not-allowed disabled:opacity-50"
        type="button"
        [disabled]="!selectedPreference"
        (click)="saveReviewInput(reviewInput.value, selectedPreference || '')"
      >
        Done
      </button>
      } @case (COMPARE_PRODUCTS_STEP) {
      <app-review-product-slider
        *ngIf="subPreferences$ | async as subPreferences"
        [subPreferences]="subPreferences"
        [min]="minSubPreferenceValue"
        [max]="maxSubPreferenceValue"
        [initialRecommendationValue]="productCard.matchPercentage"
        (ratingValueChange)="onSliderChange($event)"
      >
      </app-review-product-slider>

      <app-ranking-lineup [productLineup]="productLineup"></app-ranking-lineup>
      <!-- BIND THIS  -->
      <button
        class="mt-4 inline-flex h-12 items-center justify-center rounded-xl border border-emerald-800 px-10 text-lg font-medium tracking-wide text-emerald-900 transition hover:bg-emerald-50 disabled:cursor-not-allowed disabled:opacity-50"
        type="button"
        [disabled]="!selectedRating"
        (click)="createReview()"
      >
        Rate
      </button>
      } }
    </div>
  </div>
</ng-container>

<!-- TODO: revisit product comparison post-MVP -->
<!-- <app-review-product-ranking
        (undoSelected)="undoSelected.emit()"
        (tooToughSelected)="tooToughSelected.emit()"
        (skipSelected)="skipSelected.emit()"
      ></app-review-product-ranking> -->
