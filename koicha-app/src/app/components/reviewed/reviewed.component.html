<!-- TODO: add consistent content box sizing -->

<ng-container *ngIf="authService.user$ | async as user; else signedOut">
  <div class="relative">
    <div
      *ngIf="loading"
      class="status flex min-h-[12rem] items-center justify-center px-4 text-center font-mono text-2xl text-green-700"
    >
      ...
    </div>
    <ng-container *ngIf="!loading && userReviews.length">
      <app-feed
        [cards]="userReviews"
        (reviewSelected)="onReviewSelected($event)"
        (productToReview)="onReviewProduct($event)"
        (productToBookmark)="onBookmarkProduct($event)"
      ></app-feed>
    </ng-container>
    <ng-container *ngIf="!loading && !userReviews.length">
      <ng-container *ngTemplateOutlet="emptyState"></ng-container>
    </ng-container>

    <div
      *ngIf="productToReview"
      class="fixed inset-0 z-10 flex items-center justify-center bg-black/10 p-4"
      (click)="closeReviewCard()"
    >
      <app-create-review-card
        class="max-w-2xl"
        [productCard]="productToReview"
        (click)="$event.stopPropagation()"
        (reviewCreated)="onReviewCreated($event)"
        (closeSelected)="closeReviewCard()"
      ></app-create-review-card>
    </div>

    <!-- TODO: decide whether to keep the grey out effect upon selecting a specific product -->
    <div
      *ngIf="selectedReview"
      class="fixed inset-0 z-10 flex items-center justify-center bg-black/10 p-4"
      (click)="clearSelection()"
    >
      <app-review-details
        class="max-w-2xl"
        [selectedReview]="selectedReview"
        (click)="$event.stopPropagation()"
        (closed)="clearSelection()"
      ></app-review-details>
    </div>
  </div>
</ng-container>

<ng-template #emptyState>
  <div
    class="status flex min-h-[12rem] items-center justify-center px-4 text-center font-mono text-2xl text-green-700"
  >
    no reviews yet - get sipping!
  </div>
</ng-template>

<!-- TODO: styling -->
<ng-template #signedOut>
  <div
    class="status flex min-h-[12rem] items-center justify-center px-4 text-center font-mono text-2xl text-green-700"
  >
    sign in or sign up to view
  </div>
</ng-template>
