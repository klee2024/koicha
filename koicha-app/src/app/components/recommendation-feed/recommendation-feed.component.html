<section class="recommendation-feed">
  <div class="filters">
    <div
      class="filter-row flex flex-wrap items-center gap-x-4 gap-y-2 pl-4 md:gap-x-10"
    >
      <span class="font-mono text-base shrink-0 md:text-xl"
        >flavor profiles</span
      >
      <ul
        class="filter-list flex flex-wrap items-center gap-2 md:gap-4"
        aria-label="Flavor profile tags"
      >
        <li
          *ngFor="let tag of allTags; trackBy: trackById"
          [id]="tag.id"
          (click)="toggleTag(tag.slug)"
          class="text-base font-sans md:text-xl"
        >
          <button
            [class.is-active-green-700]="activeTagSlugs.includes(tag.slug)"
          >
            {{ tag.name }}
          </button>
        </li>
      </ul>
    </div>
    <div
      class="filter-row flex flex-wrap items-center gap-x-4 gap-y-2 pl-4 mt-4 md:gap-x-16"
    >
      <span class="font-mono text-base pr-3 md:text-xl">preparations</span>
      <ul
        class="filter-list flex flex-wrap items-center gap-2 w-full md:gap-4 md:w-auto"
        aria-label="Preparations"
      >
        <li
          *ngFor="let prep of allPreps; trackBy: trackById"
          [id]="prep.id"
          (click)="togglePreparation(prep.slug)"
          class="text-base font-sans md:text-xl"
        >
          <button
            [class.is-active-green-700]="activePrepSlug === prep.slug"
            class="lowercase"
          >
            {{ prep.name }}
          </button>
        </li>
      </ul>
    </div>
    <button
      type="button"
      class="clear-filters pl-4 pt-3"
      (click)="clearFilters()"
    >
      clear filters
    </button>
  </div>

  <div class="feed">
    <div class="status pl-4" *ngIf="loading">...</div>

    <div
      class="status flex min-h-[12rem] items-center justify-center px-4 text-center font-mono text-2xl text-green-700"
      *ngIf="!loading && filteredProductCards.length === 0"
    >
      No products found. You have unique taste!
    </div>

    <div
      *ngIf="productToReview"
      class="fixed inset-0 z-10 flex items-center justify-center bg-black/10 p-4"
      (click)="closeReviewCard()"
    >
      <app-create-review-card
        class="max-w-2xl"
        [productCard]="productToReview"
        (click)="$event.stopPropagation()"
        (reviewCreated)="onReviewCreated($event)"
        (closeSelected)="closeReviewCard()"
      ></app-create-review-card>
    </div>

    <app-feed
      [cards]="filteredProductCards"
      (productToReview)="onReviewProduct($event)"
      (productToBookmark)="onBookmarkProduct($event)"
    ></app-feed>
  </div>
</section>

@if (showSignup) {
<div
  class="fixed inset-0 z-40 bg-white/40 backdrop-blur-sm"
  (click)="showSignup = false; pendingAction = undefined"
>
  <div
    class="flex min-h-full items-center justify-center p-4"
    (click)="$event.stopPropagation()"
  >
    <app-signup-signin
      mode="signUp"
      [overlay]="true"
      (closed)="onSignupComplete()"
      (dismissed)="showSignup = false; pendingAction = undefined"
    ></app-signup-signin>
  </div>
</div>
}
